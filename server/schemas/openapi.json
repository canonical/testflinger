{
  "components": {
    "schemas": {
      "ActionIn": {
        "additionalProperties": false,
        "properties": {
          "action": {
            "enum": [
              "cancel"
            ],
            "type": "string"
          }
        },
        "required": [
          "action"
        ],
        "type": "object"
      },
      "AgentIn": {
        "additionalProperties": false,
        "properties": {
          "comment": {
            "type": "string"
          },
          "identifier": {
            "type": "string"
          },
          "job_id": {
            "description": "Job ID the device is running, if any",
            "type": "string"
          },
          "location": {
            "description": "Location of the device",
            "type": "string"
          },
          "log": {
            "description": "Push and keep only the last 100 lines",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "provision_type": {
            "type": "string"
          },
          "queues": {
            "description": "Queues the device is listening on",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "state": {
            "description": "State the device is in",
            "type": "string"
          }
        },
        "type": "object"
      },
      "AgentOut": {
        "additionalProperties": false,
        "properties": {
          "comment": {
            "type": "string"
          },
          "job_id": {
            "type": "string"
          },
          "location": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "provision_type": {
            "type": "string"
          },
          "queues": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "restricted_to": {
            "additionalProperties": {},
            "type": "object"
          },
          "state": {
            "type": "string"
          }
        },
        "required": [
          "name"
        ],
        "type": "object"
      },
      "Attachment": {
        "additionalProperties": false,
        "properties": {
          "agent": {
            "type": "string"
          },
          "device": {
            "type": "string"
          }
        },
        "required": [
          "agent"
        ],
        "type": "object"
      },
      "ClientPermissionsIn": {
        "additionalProperties": false,
        "properties": {
          "client_secret": {
            "type": "string"
          },
          "max_priority": {
            "additionalProperties": {
              "type": "integer"
            },
            "type": "object"
          },
          "max_reservation_time": {
            "additionalProperties": {
              "type": "integer"
            },
            "type": "object"
          },
          "role": {
            "enum": [
              "admin",
              "manager",
              "contributor",
              "user"
            ],
            "type": "string"
          }
        },
        "type": "object"
      },
      "ClientPermissionsOut": {
        "additionalProperties": false,
        "properties": {
          "allowed_queues": {
            "items": {
              "type": "string"
            },
            "nullable": true,
            "type": "array"
          },
          "client_id": {
            "type": "string"
          },
          "max_priority": {
            "additionalProperties": {
              "type": "integer"
            },
            "nullable": true,
            "type": "object"
          },
          "max_reservation_time": {
            "additionalProperties": {},
            "nullable": true,
            "type": "object"
          },
          "role": {
            "type": "string"
          }
        },
        "required": [
          "allowed_queues",
          "client_id",
          "max_priority",
          "max_reservation_time",
          "role"
        ],
        "type": "object"
      },
      "FileUpload": {
        "additionalProperties": false,
        "properties": {
          "file": {
            "format": "binary",
            "type": "string"
          }
        },
        "required": [
          "file"
        ],
        "type": "object"
      },
      "HTTPError": {
        "properties": {
          "detail": {
            "type": "object"
          },
          "message": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "ImagePostIn": {
        "additionalProperties": false,
        "properties": {
          "data": {
            "additionalProperties": {
              "additionalProperties": {
                "description": "Image provision data",
                "type": "string"
              },
              "description": "Image data for the queue",
              "type": "object"
            },
            "type": "object"
          }
        },
        "required": [
          "data"
        ],
        "type": "object"
      },
      "Job": {
        "additionalProperties": false,
        "properties": {
          "allocate_data": {
            "additionalProperties": {},
            "type": "object"
          },
          "allocation_timeout": {
            "type": "integer"
          },
          "debug": {
            "type": "boolean"
          },
          "firmware_update_data": {
            "additionalProperties": {},
            "type": "object"
          },
          "global_timeout": {
            "type": "integer"
          },
          "job_id": {
            "type": "string"
          },
          "job_priority": {
            "type": "integer"
          },
          "job_queue": {
            "type": "string"
          },
          "job_status_webhook": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "output_timeout": {
            "type": "integer"
          },
          "parent_job_id": {
            "type": "string"
          },
          "provision_data": {
            "anyOf": [
              {
                "nullable": true,
                "type": "object"
              },
              {
                "$ref": "#/components/schemas/ProvisionData"
              }
            ]
          },
          "reserve_data": {
            "$ref": "#/components/schemas/ReserveData"
          },
          "tags": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "test_data": {
            "$ref": "#/components/schemas/TestData"
          }
        },
        "required": [
          "job_queue"
        ],
        "type": "object"
      },
      "JobEvent": {
        "additionalProperties": false,
        "properties": {
          "detail": {
            "type": "string"
          },
          "event_name": {
            "type": "string"
          },
          "timestamp": {
            "type": "string"
          }
        },
        "required": [
          "event_name",
          "timestamp"
        ],
        "type": "object"
      },
      "JobId": {
        "additionalProperties": false,
        "properties": {
          "job_id": {
            "type": "string"
          }
        },
        "required": [
          "job_id"
        ],
        "type": "object"
      },
      "JobInQueueOut": {
        "additionalProperties": false,
        "properties": {
          "created_at": {
            "type": "string"
          },
          "job_id": {
            "type": "string"
          },
          "job_queue": {
            "type": "string"
          },
          "job_state": {
            "type": "string"
          }
        },
        "required": [
          "created_at",
          "job_id",
          "job_queue",
          "job_state"
        ],
        "type": "object"
      },
      "JobSearchResponse": {
        "additionalProperties": false,
        "properties": {
          "jobs": {
            "items": {
              "$ref": "#/components/schemas/Job"
            },
            "type": "array"
          }
        },
        "required": [
          "jobs"
        ],
        "type": "object"
      },
      "LogGet": {
        "additionalProperties": false,
        "properties": {
          "output": {
            "additionalProperties": {
              "$ref": "#/components/schemas/LogGetItem"
            },
            "type": "object"
          },
          "serial": {
            "additionalProperties": {
              "$ref": "#/components/schemas/LogGetItem"
            },
            "type": "object"
          }
        },
        "type": "object"
      },
      "LogGetItem": {
        "additionalProperties": false,
        "properties": {
          "last_fragment_number": {
            "description": "The highest fragment number for this phase",
            "type": "integer"
          },
          "log_data": {
            "description": "Combined log text from all matching fragments for this phase",
            "type": "string"
          }
        },
        "required": [
          "last_fragment_number",
          "log_data"
        ],
        "type": "object"
      },
      "LogPost": {
        "additionalProperties": false,
        "properties": {
          "fragment_number": {
            "description": "Sequential fragment number of the log fragment being posted, starting from 0",
            "type": "integer"
          },
          "log_data": {
            "description": "The log content for this fragment",
            "type": "string"
          },
          "phase": {
            "description": "Test phase name (setup, provision, firmware_update, test, allocate, reserve, cleanup)",
            "enum": [
              "setup",
              "provision",
              "firmware_update",
              "test",
              "allocate",
              "reserve",
              "cleanup"
            ],
            "type": "string"
          },
          "timestamp": {
            "description": "Timestamp in ISO 8601 format of when the log fragment was created",
            "format": "date-time",
            "type": "string"
          }
        },
        "required": [
          "fragment_number",
          "log_data",
          "phase",
          "timestamp"
        ],
        "type": "object"
      },
      "Oauth2RefreshTokenIn": {
        "additionalProperties": false,
        "properties": {
          "refresh_token": {
            "description": "Opaque refresh token",
            "type": "string"
          }
        },
        "required": [
          "refresh_token"
        ],
        "type": "object"
      },
      "Oauth2RefreshTokenOut": {
        "additionalProperties": false,
        "properties": {
          "access_token": {
            "type": "string"
          },
          "expires_in": {
            "type": "integer"
          },
          "token_type": {
            "type": "string"
          }
        },
        "required": [
          "access_token",
          "expires_in",
          "token_type"
        ],
        "type": "object"
      },
      "Oauth2Token": {
        "additionalProperties": false,
        "properties": {
          "access_token": {
            "type": "string"
          },
          "expires_in": {
            "type": "integer"
          },
          "refresh_token": {
            "type": "string"
          },
          "token_type": {
            "type": "string"
          }
        },
        "required": [
          "access_token",
          "expires_in",
          "refresh_token",
          "token_type"
        ],
        "type": "object"
      },
      "ProvisionData": {
        "additionalProperties": false,
        "properties": {},
        "type": "object"
      },
      "ProvisionLogsIn": {
        "additionalProperties": false,
        "properties": {
          "detail": {
            "type": "string"
          },
          "exit_code": {
            "type": "integer"
          },
          "job_id": {
            "type": "string"
          }
        },
        "required": [
          "exit_code",
          "job_id"
        ],
        "type": "object"
      },
      "QueueDict": {
        "additionalProperties": false,
        "properties": {
          "data": {
            "additionalProperties": {
              "description": "Queue description",
              "type": "string"
            },
            "type": "object"
          }
        },
        "required": [
          "data"
        ],
        "type": "object"
      },
      "QueueName": {
        "additionalProperties": false,
        "properties": {
          "queue": {
            "type": "string"
          }
        },
        "required": [
          "queue"
        ],
        "type": "object"
      },
      "QueueWaitTimePercentilesOut": {
        "additionalProperties": false,
        "properties": {
          "data": {
            "additionalProperties": {
              "additionalProperties": {
                "type": "number"
              },
              "description": "Percentile statistics for job wait times in seconds",
              "type": "object"
            },
            "type": "object"
          }
        },
        "required": [
          "data"
        ],
        "type": "object"
      },
      "ReserveData": {
        "additionalProperties": false,
        "properties": {
          "ssh_keys": {
            "items": {
              "pattern": "^(lp|gh):(\\S+)$",
              "type": "string"
            },
            "type": "array"
          },
          "timeout": {
            "nullable": true
          }
        },
        "type": "object"
      },
      "RestrictedQueueIn": {
        "additionalProperties": false,
        "properties": {
          "client_id": {
            "type": "string"
          }
        },
        "required": [
          "client_id"
        ],
        "type": "object"
      },
      "RestrictedQueueOut": {
        "additionalProperties": false,
        "properties": {
          "owners": {
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "queue": {
            "type": "string"
          }
        },
        "required": [
          "owners",
          "queue"
        ],
        "type": "object"
      },
      "Result": {
        "additionalProperties": false,
        "properties": {},
        "type": "object"
      },
      "ResultGet": {
        "additionalProperties": false,
        "properties": {
          "allocate_output": {
            "type": "string"
          },
          "allocate_serial": {
            "type": "string"
          },
          "allocate_status": {
            "type": "integer"
          },
          "cleanup_output": {
            "type": "string"
          },
          "cleanup_serial": {
            "type": "string"
          },
          "cleanup_status": {
            "type": "integer"
          },
          "device_info": {
            "additionalProperties": {},
            "type": "object"
          },
          "firmware_update_output": {
            "type": "string"
          },
          "firmware_update_serial": {
            "type": "string"
          },
          "firmware_update_status": {
            "type": "integer"
          },
          "job_state": {
            "type": "string"
          },
          "provision_output": {
            "type": "string"
          },
          "provision_serial": {
            "type": "string"
          },
          "provision_status": {
            "type": "integer"
          },
          "reserve_output": {
            "type": "string"
          },
          "reserve_serial": {
            "type": "string"
          },
          "reserve_status": {
            "type": "integer"
          },
          "setup_output": {
            "type": "string"
          },
          "setup_serial": {
            "type": "string"
          },
          "setup_status": {
            "type": "integer"
          },
          "test_output": {
            "type": "string"
          },
          "test_serial": {
            "type": "string"
          },
          "test_status": {
            "type": "integer"
          }
        },
        "type": "object"
      },
      "SecretIn": {
        "additionalProperties": false,
        "properties": {
          "value": {
            "type": "string"
          }
        },
        "required": [
          "value"
        ],
        "type": "object"
      },
      "StatusUpdate": {
        "additionalProperties": false,
        "properties": {
          "agent_id": {
            "type": "string"
          },
          "events": {
            "items": {
              "$ref": "#/components/schemas/JobEvent"
            },
            "type": "array"
          },
          "job_queue": {
            "type": "string"
          },
          "job_status_webhook": {
            "format": "url",
            "type": "string"
          }
        },
        "required": [
          "job_status_webhook"
        ],
        "type": "object"
      },
      "TestData": {
        "additionalProperties": false,
        "properties": {
          "attachments": {
            "items": {
              "$ref": "#/components/schemas/Attachment"
            },
            "type": "array"
          },
          "secrets": {
            "additionalProperties": {
              "pattern": "^[a-zA-Z0-9_/-]+$",
              "type": "string"
            },
            "type": "object"
          },
          "test_cmds": {
            "type": "string"
          },
          "test_password": {
            "type": "string"
          },
          "test_username": {
            "type": "string"
          }
        },
        "type": "object"
      },
      "ValidationError": {
        "properties": {
          "detail": {
            "properties": {
              "<location>": {
                "properties": {
                  "<field_name>": {
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  }
                },
                "type": "object"
              }
            },
            "type": "object"
          },
          "message": {
            "type": "string"
          }
        },
        "type": "object"
      }
    },
    "securitySchemes": {
      "BasicAuth": {
        "description": "Base64 encoded pair of client_id:client_key",
        "scheme": "basic",
        "type": "http"
      },
      "BearerAuth": {
        "description": "Based64-encoded JWT access token with permissions to access restricted queues",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_10": {
        "description": "Based64-encoded JWT access token with permissions to delete secrets",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_2": {
        "description": "Based64-encoded JWT access token with permissions to access restricted queues",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_3": {
        "description": "Based64-encoded JWT access token with admin or manager permissions",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_4": {
        "description": "Based64-encoded JWT access token with admin or manager permissions",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_5": {
        "description": "Based64-encoded JWT access token with admin or manager permissions",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_6": {
        "description": "Based64-encoded JWT access token with admin or manager permissions",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_7": {
        "description": "Based64-encoded JWT access token with admin or manager permissions",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_8": {
        "description": "Based64-encoded JWT access token with admin permissions",
        "scheme": "bearer",
        "type": "http"
      },
      "BearerAuth_9": {
        "description": "Based64-encoded JWT access token with permissions to store secrets",
        "scheme": "bearer",
        "type": "http"
      }
    }
  },
  "info": {
    "title": "Testflinger API",
    "version": "1.0.0"
  },
  "openapi": "3.0.3",
  "paths": {
    "/metrics": {
      "get": {
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          }
        },
        "summary": "Prometheus Metrics"
      }
    },
    "/v1/": {
      "get": {
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          }
        },
        "summary": "Identify ourselves.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/agents/data": {
      "get": {
        "description": "Returns JSON data for all known agents, including their state,\nqueues, location, and information about restricted queue ownership.\nUseful for external systems monitoring agents.",
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/AgentOut"
                  },
                  "type": "array"
                }
              }
            },
            "description": "JSON data for all known agents, useful for external systems that need to gather this information"
          }
        },
        "summary": "Get all agent data.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/agents/data/{agent_name}": {
      "get": {
        "description": "Returns JSON data for the specified agent, including state, queues,\nlocation, and restricted queue ownership information.",
        "parameters": [
          {
            "in": "path",
            "name": "agent_name",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentOut"
                }
              }
            },
            "description": "JSON data for the specified agent, useful for getting information from a single agent. "
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified agent was not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Get the information from a specified agent.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "The json sent to this endpoint may contain data such as the following:\n{\n\"state\": string, # State the device is in\n\"queues\": array[string], # Queues the device is listening on\n\"location\": string, # Location of the device\n\"job_id\": string, # Job ID the device is running, if any\n\"log\": array[string], # push and keep only the last 100 lines\n}",
        "parameters": [
          {
            "in": "path",
            "name": "agent_name",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AgentIn"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Post information about the agent to the server.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/agents/images": {
      "post": {
        "description": "Images will be stored in a dict of key/value pairs as part of the\nqueues collection.",
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "myqueue": {
                  "core22": "http://cdimage.ubuntu.com/.../core-22.tar.gz",
                  "jammy": "http://cdimage.ubuntu.com/.../ubuntu-22.04.tar.gz"
                },
                "other_queue": {
                  "image1": "data1",
                  "image2": "data2"
                }
              },
              "schema": {
                "$ref": "#/components/schemas/ImagePostIn"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Tell testflinger about known images for a specified queue.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/agents/images/{queue}": {
      "get": {
        "description": "Returns a dictionary mapping image names to their provisioning URLs\nor data. Returns an empty dict if the queue doesn't exist or has no\nimages.",
        "parameters": [
          {
            "in": "path",
            "name": "queue",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "example": {
                    "core22": "url: http://.../core22.img.xz",
                    "server-22.04": "url: http://.../ubuntu-22.04.img.xz"
                  },
                  "type": "object"
                }
              }
            },
            "description": "Mapping of image names and provision data"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Get image names and provisioning data for a queue.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/agents/provision_logs/{agent_name}": {
      "post": {
        "description": "Submit provision log entries including job_id, exit_code, and detail\ninformation. The server maintains the last 100 provision log entries\nper agent and tracks provision success/failure streaks.",
        "parameters": [
          {
            "in": "path",
            "name": "agent_name",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "detail": "foo",
                "exit_code": 1,
                "job_id": "00000000-0000-0000-0000-000000000000"
              },
              "schema": {
                "$ref": "#/components/schemas/ProvisionLogsIn"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Post provision logs for the agent to the server.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/agents/queues": {
      "get": {
        "description": "Returns a dict of queue names and descriptions, ex:\n{\n\"some_queue\": \"A queue for testing\",\n\"other_queue\": \"A queue for something else\"\n}",
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "example": {
                    "device001": "Queue for device001",
                    "some-queue": "some other queue"
                  },
                  "type": "object"
                }
              }
            },
            "description": "Mapping of queue names and descriptions"
          }
        },
        "summary": "Get all advertised queues from this server.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "Some agents may want to advertise some of the queues they listen on so that\nthe user can check which queues are valid to use.",
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "myqueue": "queue 1",
                "myqueue2": "queue 2"
              },
              "schema": {
                "$ref": "#/components/schemas/QueueDict"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Tell testflinger the queue names that are being serviced.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/client-permissions": {
      "get": {
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/ClientPermissionsOut"
                  },
                  "type": "array"
                }
              }
            },
            "description": "JSON data with a list all client IDs and its permission excluding the hashed secret stored in database"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user"
          }
        },
        "security": [
          {
            "BearerAuth_5": []
          }
        ],
        "summary": "Retrieve all all client_id and their permissions from database.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/client-permissions/{client_id}": {
      "delete": {
        "parameters": [
          {
            "in": "path",
            "name": "client_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user to delete client permissions"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified client_id was not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "(Unprocessable Entity) System admin can't be removed using the API"
          }
        },
        "security": [
          {
            "BearerAuth_8": []
          }
        ],
        "summary": "Delete client id along with its permissions.",
        "tags": [
          "V1"
        ]
      },
      "get": {
        "parameters": [
          {
            "in": "path",
            "name": "client_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ClientPermissionsOut"
                }
              }
            },
            "description": "JSON data with the permissions of a specified client excluding the hashed secret stored in database"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified client_id was not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "security": [
          {
            "BearerAuth_6": []
          }
        ],
        "summary": "Retrieve single client-permissions from database.",
        "tags": [
          "V1"
        ]
      },
      "put": {
        "parameters": [
          {
            "in": "path",
            "name": "client_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "client_id": "myclient",
                "client_secret": "my-secret-password",
                "max_priority": {},
                "max_reservation_time": {
                  "*": 40000
                },
                "role": "contributor"
              },
              "schema": {
                "$ref": "#/components/schemas/ClientPermissionsIn"
              }
            }
          }
        },
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) Missing client_secret when creating new client permissions"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user to modify client permissions"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified client_id was not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "(Unprocessable Entity) System admin client cannot be modified using the API"
          }
        },
        "security": [
          {
            "BearerAuth_7": []
          }
        ],
        "summary": "Add or create client permissions for a specified user.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job": {
      "get": {
        "description": "When an agent wants to request a job for processing, it can make this\nrequest along with a list of one or more queues that it is configured\nto process. The server will only return one job.\n\nNote:\nAny secrets that are referenced in the job are \"resolved\" when the\njob is retrieved by an agent through this endpoint. Any secrets that\nare inaccessible at the time of retrieval will be resolved to the\nempty string.",
        "parameters": [
          {
            "description": "List of queue name(s) that the agent can process",
            "explode": true,
            "in": "query",
            "name": "queue",
            "required": true,
            "schema": {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "style": "form"
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Job"
                }
              }
            },
            "description": "(OK) JSON job data that was submitted by the requester"
          },
          "204": {
            "content": {},
            "description": "(No Content) No jobs available in the specified queues"
          },
          "400": {
            "content": {},
            "description": "(Bad request) No queue is specified in the request"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Get a test job from the specified queue(s).",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "Most parameters passed in the data section of this API will be specific\nto the type of agent receiving them. The `job_queue` parameter is used\nto designate the queue used, but all others will be passed along to\nthe agent.",
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "job_queue": "myqueue",
                "name": "Example Test Job",
                "provision_data": {
                  "url": "<url>"
                },
                "tags": [
                  "test",
                  "sample"
                ],
                "test_data": {
                  "test_cmds": "lsb_release -a"
                }
              },
              "schema": {
                "$ref": "#/components/schemas/Job"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "job_id": "550e8400-1234-1234-1234-446655440000"
                },
                "schema": {
                  "$ref": "#/components/schemas/JobId"
                }
              }
            },
            "description": "(OK) Returns the job_id (UUID) of the newly created job"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "(Unprocessable Content) The submitted job contains references to secrets that are inaccessible"
          }
        },
        "summary": "Create a test job request and place it on the specified queue.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job/search": {
      "get": {
        "description": "Parameters:\n- `tags` (array): List of string tags to search for\n- `match` (string): Match mode for\n- `tags` (string, \"all\" or \"any\", default: \"any\")\n- `state` (array): List of job states to include (or \"active\" to\nsearch all states other than cancelled and completed)",
        "parameters": [
          {
            "description": "List of tags to search for",
            "explode": true,
            "in": "query",
            "name": "tags",
            "required": false,
            "schema": {
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "style": "form"
          },
          {
            "description": "Match mode - 'all' or 'any' (default 'any')",
            "in": "query",
            "name": "match",
            "required": false,
            "schema": {
              "enum": [
                "any",
                "all"
              ],
              "type": "string"
            }
          },
          {
            "description": "List of job states to include",
            "explode": true,
            "in": "query",
            "name": "state",
            "required": false,
            "schema": {
              "items": {
                "enum": [
                  "setup",
                  "provision",
                  "firmware_update",
                  "test",
                  "allocate",
                  "allocated",
                  "reserve",
                  "cleanup",
                  "cancelled",
                  "completed",
                  "active"
                ],
                "type": "string"
              },
              "type": "array"
            },
            "style": "form"
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "jobs": [
                    {
                      "job_id": "550e8400-e29b-41d4-a716-446655440000",
                      "job_queue": "myqueue"
                    }
                  ]
                },
                "schema": {
                  "$ref": "#/components/schemas/JobSearchResponse"
                }
              }
            },
            "description": "Successful response"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Search for jobs by tag(s) and state(s).",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job/{job_id}": {
      "get": {
        "description": "Returns the job definition even if the job has already run.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Job"
                }
              }
            },
            "description": "(OK) JSON data for the job"
          },
          "204": {
            "content": {},
            "description": "(No Content) Job not found"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Request the json job definition for a specified job.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job/{job_id}/action": {
      "post": {
        "description": "Supported actions:\n- cancel: Cancel a job that hasn't been completed yet",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "action": "cancel"
              },
              "schema": {
                "$ref": "#/components/schemas/ActionIn"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/None"
                }
              }
            },
            "description": "(OK) Action executed successfully"
          },
          "400": {
            "content": {},
            "description": " (Bad Request) The job is already completed or cancelled"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The job isn't found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "(Unprocessable Entity) The action or the argument to it could not be processed"
          }
        },
        "summary": "Execute action for the specified job_id.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job/{job_id}/attachments": {
      "get": {
        "description": "Returns a gzip-compressed tarball containing all files that were\nuploaded as attachments.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "content": {},
            "description": "(No Content) No attachments found for this job"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Download the attachments bundle for a specified job_id.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "Upload a gzip-compressed tarball containing files to be used as\nattachments for the job.\nThe job must be in a state where it's awaiting attachments.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/FileUpload"
              }
            }
          }
        },
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "(Unprocessable Entity) Job not awaiting attachments or the job_id is not valid"
          }
        },
        "summary": "Post attachment bundle for a specified job_id.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job/{job_id}/events": {
      "post": {
        "description": "The `job_status_webhook` parameter is required for this endpoint.\nOther parameters included here will be forwarded to the webhook.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "agent_id": "agent-00",
                "events": [
                  {
                    "detail": "my_detailed_message",
                    "event_name": "started_provisioning",
                    "timestamp": "2024-05-03T19:11:33.541130+00:00"
                  }
                ],
                "job_queue": "myqueue",
                "job_status_webhook": "http://mywebhook"
              },
              "schema": {
                "$ref": "#/components/schemas/StatusUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/None"
                }
              }
            },
            "description": "(OK) Text response from the webhook if the server was successfully able to post."
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id or JSON data specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          },
          "504": {
            "content": {},
            "description": "(Gateway Timeout) The webhook did not respond in time"
          }
        },
        "summary": "Post job status updates to the specified webhook URL.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/job/{job_id}/position": {
      "get": {
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/"
                }
              }
            },
            "description": "(OK) Zero-based position indicating how many jobs are ahead of this job in the queue."
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "410": {
            "content": {},
            "description": "(Gone) Job not found or already started"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Return the position of the specified job_id in the queue.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/oauth2/refresh": {
      "post": {
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "refresh_token": "<opaque-refresh-token>"
              },
              "schema": {
                "$ref": "#/components/schemas/Oauth2RefreshTokenIn"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "access_token": "<new-JWT-Access-Token>",
                  "expires_in": 30,
                  "token_type": "Bearer"
                },
                "schema": {
                  "$ref": "#/components/schemas/Oauth2RefreshTokenOut"
                }
              }
            },
            "description": "(OK) JSON object containing new access token, token type, and expiration time"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Missing, invalid, revoked, or expired refresh token"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Refresh access token using a valid refresh token.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/oauth2/revoke": {
      "post": {
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "refresh_token": "<opaque-refresh-token>"
              },
              "schema": {
                "$ref": "#/components/schemas/Oauth2RefreshTokenIn"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "message": "Refresh token revoked successfully"
                },
                "schema": {
                  "$ref": "#/components/schemas/"
                }
              }
            },
            "description": "(OK) Text response indicating successful revocation of the refresh token"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Missing, invalid, or already revoked refresh token"
          },
          "401": {
            "content": {},
            "description": "(Unauthorized) Admin privileges required to revoke refresh tokens"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Revoke a refresh token. Only admins can perform this action.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/oauth2/token": {
      "post": {
        "description": "Get JWT with priority and queue permissions.\n\nBefore being encrypted, the JWT can contain fields like:\n{\nexp: <Expiration DateTime of Token>,\niat: <Issuance DateTime of Token>,\nsub: <Subject Field of Token>,\npermissions: {\nmax_priority: <Queue to Priority Level Dict>,\nallowed_queues: <List of Allowed Restricted Queues>,\nmax_reservation_time: <Queue to Max Reservation Time Dict>,\n}\n}\nNotes:\n- `expires_in` is the lifetime (in seconds) of the access token.\n- Refresh tokens default to 30 days; admin may issue non-expiring\ntokens for trusted integrations.",
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "access_token": "<JWT Access Token>",
                  "expires_in": 30,
                  "refresh_token": "<Refresh Token>",
                  "token_type": "Bearer"
                },
                "schema": {
                  "$ref": "#/components/schemas/Oauth2Token"
                }
              }
            },
            "description": "(OK) JSON object containing access token, token type, expiration time, and refresh token"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Invalid client id or client key"
          }
        },
        "security": [
          {
            "BasicAuth": []
          }
        ],
        "summary": "Issue both access token and refresh token for a client.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/queues/wait_times": {
      "get": {
        "description": "Returns percentile statistics (p5, p10, p50, p90, p95) for job wait\ntimes in the specified queues. If no queues are specified, returns\nmetrics for all queues.",
        "parameters": [
          {
            "description": "List of queue names",
            "explode": true,
            "in": "query",
            "name": "queue",
            "required": false,
            "schema": {
              "items": {
                "$ref": "#/components/schemas/QueueName"
              },
              "type": "array"
            },
            "style": "form"
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "queue1": {
                    "10": 5.0,
                    "5": 2.0,
                    "50": 15.0,
                    "90": 45.0,
                    "95": 60.0
                  },
                  "queue2": {
                    "10": 20.0,
                    "5": 9.0,
                    "50": 60.0,
                    "90": 80.0,
                    "95": 90.0
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/QueueWaitTimePercentilesOut"
                }
              }
            },
            "description": "(OK) JSON mapping of queue names to wait time metrics percentiles"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Get wait time metrics for queues.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/queues/{queue_name}/agents": {
      "get": {
        "parameters": [
          {
            "in": "path",
            "name": "queue",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/AgentOut"
                  },
                  "type": "array"
                }
              }
            },
            "description": "JSON data with an array of agent objects listening to the specified queue, including the agent state, location, and current job information."
          },
          "204": {
            "content": {},
            "description": "(No Content) No agents found listening to the specified queue"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified queue does not exist"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Get the list of all data for agents listening to a specified queue.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/queues/{queue_name}/jobs": {
      "get": {
        "description": "Returns JSON data with an array of job objects including job_id,\ncreated_at timestamp, job_state, and job_queue for all jobs in the\nspecified queue.",
        "parameters": [
          {
            "in": "path",
            "name": "queue",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/JobInQueueOut"
                  },
                  "type": "array"
                }
              }
            },
            "description": "JSON data with an array of job objects including job_id, created_at timestamp, job_state, and job_queue for all jobs in the specified queue."
          },
          "204": {
            "content": {},
            "description": "(No Content) No jobs found in the specified queue"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Get the jobs in a specified queue along with their state.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/restricted-queues": {
      "get": {
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/RestrictedQueueOut"
                  },
                  "type": "array"
                }
              }
            },
            "description": "Successful response"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user to access restricted queues"
          }
        },
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "summary": "List all agent's restricted queues and its owners.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/restricted-queues/{queue_name}": {
      "delete": {
        "parameters": [
          {
            "in": "path",
            "name": "queue",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "client_id": "myclient"
              },
              "schema": {
                "$ref": "#/components/schemas/RestrictedQueueIn"
              }
            }
          }
        },
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) Missing client_id to remove as owner of restricted queue"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user to remove restricted queues"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified queue was not found or it is not in the restricted queue list"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "security": [
          {
            "BearerAuth_4": []
          }
        ],
        "summary": "Delete an owner from the specific restricted queue.",
        "tags": [
          "V1"
        ]
      },
      "get": {
        "parameters": [
          {
            "in": "path",
            "name": "queue",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RestrictedQueueOut"
                }
              }
            },
            "description": "Successful response"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user to access restricted queues"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified restricted queue was not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "security": [
          {
            "BearerAuth_2": []
          }
        ],
        "summary": "Get restricted queues for a specific agent.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "If the queue does not exist yet, it will be created automatically.",
        "parameters": [
          {
            "in": "path",
            "name": "queue",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "client_id": "myclient"
              },
              "schema": {
                "$ref": "#/components/schemas/RestrictedQueueIn"
              }
            }
          }
        },
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) Missing client_id to set as owner of restricted queue"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Unauthorized) Missing or invalid access token"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) Insufficient permissions for the authenticated user to associate restricted queues"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "(Not Found) The specified restricted queue does not exist or is not associated to an agent"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "security": [
          {
            "BearerAuth_3": []
          }
        ],
        "summary": "Add an owner to the specific restricted queue.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/result/{job_id}": {
      "get": {
        "description": "This endpoint reconstructs results from the new logging system to\nmaintain backward compatibility. It combines phase status information\nwith logs to provide a complete view of job results.\n\nReturns:\nJSON data with flattened structure including:\n- `{phase}_status`: Exit code for each phase\n- `{phase}_output`: Standard output logs for each phase\n(if available)\n- `{phase}_serial`: Serial console logs for each phase\n(if available)\n- Additional metadata fields (device_info, job_state, etc.)",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResultGet"
                }
              }
            },
            "description": "(OK) JSON data with flattened structure"
          },
          "204": {
            "content": {},
            "description": "(No Content) No results found for this job_id"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Return job outcome data for the specified job_id.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "Submit test results including exit codes for each phase, device\ninformation, and job state. The payload must not exceed the\n16MB BSON size limit.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "device_info": {},
                "status": {
                  "provision": 0,
                  "setup": 0,
                  "test": 0
                }
              },
              "schema": {
                "$ref": "#/components/schemas/Result"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/None"
                }
              }
            },
            "description": "(OK) Job outcome data posted successfully"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "413": {
            "content": {},
            "description": "(Request Entity Too Large) Payload exceeds 16MB BSON size limit"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Post job outcome data for the specified job_id.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/result/{job_id}/artifact": {
      "get": {
        "description": "Returns a gzip-compressed tarball containing test artifacts or results\nfiles.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "content": {},
            "description": "(No Content) No artifact found for this job"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Download previously submitted artifact for the specified job_id.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "Upload a gzip-compressed tarball containing test artifacts or results\nfiles.",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/FileUpload"
              }
            }
          }
        },
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Upload a file artifact for the specified job_id.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/result/{job_id}/log/{log_type}": {
      "get": {
        "description": "This endpoint supports querying logs with optional filtering by phase,\nfragment number, or timestamp. Logs are persistent and can be\nretrieved multiple times.",
        "parameters": [
          {
            "description": "Starting fragment number to query from, defaults to 0",
            "in": "query",
            "name": "start_fragment",
            "required": false,
            "schema": {
              "minimum": 0,
              "type": "integer"
            }
          },
          {
            "description": "Starting timestamp to query from, in ISO 8601 format",
            "in": "query",
            "name": "start_timestamp",
            "required": false,
            "schema": {
              "format": "date-time",
              "type": "string"
            }
          },
          {
            "description": "Test phase name to filter logs",
            "in": "query",
            "name": "phase",
            "required": false,
            "schema": {
              "enum": [
                "setup",
                "provision",
                "firmware_update",
                "test",
                "allocate",
                "reserve",
                "cleanup"
              ],
              "type": "string"
            }
          },
          {
            "description": "Type of log to retrieve (output or serial)",
            "in": "path",
            "name": "log_type",
            "required": true,
            "schema": {
              "enum": [
                "output",
                "serial"
              ],
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "example": {
                  "output": {
                    "provision": {
                      "last_fragment_number": 12,
                      "log_data": "Provisioning device...\nDevice ready\n"
                    },
                    "setup": {
                      "last_fragment_number": 5,
                      "log_data": "Starting setup...\nSetup complete\n"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/LogGet"
                }
              }
            },
            "description": "(OK) JSON object with logs organized by phase"
          },
          "204": {
            "content": {},
            "description": "(No Content) No logs found for this job_id and log_type"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id, log_type or query parameter specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Retrieve logs for the specified job_id and log type.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "description": "This is the new logging endpoint that agents use to stream log data\nin fragments. Each fragment includes metadata for tracking and\nquerying.",
        "parameters": [
          {
            "description": "Type of log to retrieve (output or serial)",
            "in": "path",
            "name": "log_type",
            "required": true,
            "schema": {
              "enum": [
                "output",
                "serial"
              ],
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "example": {
                "fragment_number": 0,
                "log_data": "Starting setup phase...",
                "phase": "setup",
                "timestamp": "2025-10-15T10:00:00+00:00"
              },
              "schema": {
                "$ref": "#/components/schemas/LogPost"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/None"
                }
              }
            },
            "description": "(OK) Log fragment posted successfully"
          },
          "400": {
            "content": {},
            "description": "(Bad Request) Invalid job_id or log_type specified"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          }
        },
        "summary": "Post a log fragment for the specified job_id and log type.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/result/{job_id}/output": {
      "get": {
        "deprecated": true,
        "description": "TODO: Remove after CLI/agent migration completes.\n\n:param job_id: UUID as a string for the job\n:raises HTTPError: BAD_REQUEST when job_id is invalid\n:return: Plain text output",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          }
        },
        "summary": "Legacy endpoint to get job output for a specified job_id.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "deprecated": true,
        "description": "TODO: Remove after CLI/agent migration completes.\n\n:param job_id: UUID as a string for the job\n:raises HTTPError: BAD_REQUEST when job_id is invalid\n:return: \"OK\" on success",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          }
        },
        "summary": "Legacy endpoint to post output for a specified job_id.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/result/{job_id}/serial_output": {
      "get": {
        "deprecated": true,
        "description": "TODO: Remove after CLI/agent migration completes.\n\n:param job_id: UUID as a string for the job\n:raises HTTPError: BAD_REQUEST when job_id is invalid\n:return: Plain text serial output",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          }
        },
        "summary": "Legacy endpoint to get latest serial output for a specified job ID.",
        "tags": [
          "V1"
        ]
      },
      "post": {
        "deprecated": true,
        "description": "TODO: Remove after CLI/agent migration completes.\n\n:param job_id: UUID as a string for the job\n:raises HTTPError: BAD_REQUEST when job_id is invalid\n:return: \"OK\" on success",
        "parameters": [
          {
            "in": "path",
            "name": "job_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {}
              }
            },
            "description": "Successful response"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          }
        },
        "summary": "Legacy endpoint to post serial output for a specified job ID.",
        "tags": [
          "V1"
        ]
      }
    },
    "/v1/secrets/{client_id}/{path}": {
      "delete": {
        "parameters": [
          {
            "in": "path",
            "name": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "client_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) No secrets store configured or access error"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Authentication error"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) client_id does not match authenticated client id"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          },
          "500": {
            "content": {},
            "description": "(Internal Server Error) Error deleting the secret value"
          }
        },
        "security": [
          {
            "BearerAuth_10": []
          }
        ],
        "summary": "Remove a secret value for the specified client_id and path.",
        "tags": [
          "V1"
        ]
      },
      "put": {
        "parameters": [
          {
            "in": "path",
            "name": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "client_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SecretIn"
              }
            }
          }
        },
        "responses": {
          "400": {
            "content": {},
            "description": "(Bad Request) No secrets store configured or access error"
          },
          "401": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Authentication error"
          },
          "403": {
            "content": {},
            "description": "(Forbidden) client_id does not match authenticated client id"
          },
          "404": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPError"
                }
              }
            },
            "description": "Not found"
          },
          "422": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationError"
                }
              }
            },
            "description": "Validation error"
          },
          "500": {
            "content": {},
            "description": "(Internal Server Error) Error storing the secret value"
          }
        },
        "security": [
          {
            "BearerAuth_9": []
          }
        ],
        "summary": "Store a secret value for the specified client_id and path.",
        "tags": [
          "V1"
        ]
      }
    }
  },
  "tags": [
    {
      "name": "V1"
    }
  ]
}
